---
title: "Visualizations"
author: "Grace2"
date: '2022-03-17'
output: html_document 
---

```{r setup, include=FALSE}
#library(readxl)
#Gamesonyourphone_ <- read_excel("extra/Gamesonyourphone?.xlsx")
#View(Gamesonyourphone_) 
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
#board_games%>%
#  arrange(desc(max_playtime))

board_games <- board_games %>%
  mutate(
    playtime_group = case_when(
      playing_time < 1 ~ "N/A",
      playing_time >= 1 & playing_time <= 20 ~ "Under 20 minutes",
      playing_time >= 21 & playing_time <= 40 ~ "20-40 minutes",
      playing_time >= 41 & playing_time <= 60 ~ "40-60 minutes",
      playing_time >= 61 & playing_time <= 120 ~ "1-2 hours",
      playing_time >= 121 & playing_time <= 180 ~ "2-3 hours",
      playing_time >= 181 & playing_time <= 240 ~ "3-4 hours",
      playing_time >= 241 & playing_time <= 360 ~ "4-6 hours",
      playing_time >= 361 ~ "Over 6 hours"
    ))
```

```{r}
board_games%>%
  count(playtime_group)%>%
  arrange(desc(n))
```


#```{r}
board_games%>%
  filter(playing_time < 1000)%>%
  arrange(desc(playing_time))
#```

stacked barplot
 

```{r, fig.alt= "In this graph, we have a histogram displaying the frequency of games in each group of playing times. It reveals that most games are under an hour, with a fairly even split between the groups of 0-20 minutes and 20-40. The 40-60 group has the most number of games. Beyond that, there are a few spikes around convenient time labels such as 2 hours, 3 hours etc, but the vast majority of games lie in this under an hour range.  }
ggplot(data = board_games, aes(playing_time, fill=playtime_group)) +
  geom_histogram() +
  xlim(0,500)
```
```{r}
board_games %>% 
  ggplot(aes(x = playtime_group , y = average_rating, color = playtime_group)) +
  geom_violin()
```

Research questions: Does this change with recommended ages? 
Does this change with different game categories?


```{r}
library(magrittr)
library(tidyverse)
library(heatmaply)

# Heatmap Prep - Counts ------------------------------------------------------------

# fix filter stuff: 


categories <- board_games %>% 
  select(category) %>% 
  separate(category, into = c("category1", "category2", "category3", "category4"), sep = ",")


cat_counts <- categories %>% 
  filter(is.na(category1) == FALSE,
         is.na(category2) == FALSE) %>% 
  group_by(category1, category2) %>% 
  count() %>% 
  arrange(desc(n)) 

top_cat1 <- categories %>% 
  group_by(category1) %>% 
  count() %>% 
  arrange(desc(n))

top_cat2 <- categories %>% 
  group_by(category2) %>% 
  count() %>% 
  arrange(desc(n))

top_cat1_list <- c("Card Game", "Abstract Strategy", "Wargame", "Economic", 
                   "Adventure", "Bluffing", "Action / Dexterity", "Animals", 
                   "Dice", "Ancient", "Fantasy", "Children's Game", 
                   "City Building", "Party Game", "Deduction", 
                   "Aviation / Flight", "Medieval", "Fighting", "Napoleonic", 
                   "American Civil War")

top_cat2_list <- c("Wargame", "Card Game", "Fantasy", "World War II",
                   "Children's Game", "Dice", "Fighting", "Economic", 
                   "Science Fiction", "Party Game", "Deduction", "Exploration",
                   "Humor", "Medieval", "Collectible Components", "Racing",
                   "Movies / TV/ Radio Theme", "Negotiation", "Miniatures", 
                   "Animals")

map_counts <- cat_counts %>% 
  filter(category1 %in% top_cat1_list & category2 %in% top_cat1_list)


# Heatmap Prep - Ratings --------------------------------------------------

rat_categories <- board_games %>% 
  select(category, average_rating, name) %>% 
  separate(category, into = c("category1", "category2", "category3", "category4"), sep = ",")

rat_averages <- rat_categories %>% 
  filter(is.na(category1) == FALSE,
         is.na(category2) == FALSE) %>% 
  group_by(category1, category2) %>% 
  summarize(avg_rat = mean(average_rating),
            count = n()) %>% 
  arrange(desc(avg_rat)) 
```


## Heatmap 
```{r heatmap, alt.text = "Heatmap showing commonly overlapping game categories, which shows that the most popular two-category descriptions are Fantasy Card Games and Bluffing Card Games."}
colors <- c("#ffffff", "#f2f0f7", "#cbc9e2", "#9e9ac8", "#756bb1", "#54278f")

heatmap <- map_counts %>% 
  ggplot(aes(x = category2, y = category1, fill = n)) +
  geom_tile() +
  scale_fill_stepsn(colors = colors, values = c(0, 0.01, 0.1, 0.25, 0.6, 1))
```

# Game Mechanics
```{r mechanic-prop-class}
Gamesonyourphone_ %>% 
  group_by(game_mechanic_pop) %>% 
  filter(!is.na(game_mechanic_pop)) %>% 
  summarize(count = n())%>% 
  arrange(desc(count)) %>% 
  mutate(proportion = (count/15)*100)
```

```{r game_mechanic_pie, alt.text = "Pie chart showing the distrobution of game mechanics perfered by DCS 210, broken down by proportion. The most prefered game mechnic was Area Control makig up 33.3 percent of responses. Dice rolling and card drafting were the next more popular, with 20 percent of the class perfering those mechanics."} 
prop_pie <- data.frame (
  mechanics = c("Area Control", "Dice Rolling", "Card Drafting", "Modular Board", "Hex and Counter", "Hand Management"),
  proportion = c(33.3, 20.0, 20.0, 13.3, 6.6, 6.6))
  
ggplot(data = prop_pie, mapping = aes(x = "", y = proportion, fill = mechanics)) + 
    geom_bar(stat = "identity", color = "black") + 
    coord_polar(theta = "y", start = 0) + 
    geom_text(aes(label = paste0(proportion, "%")),
              position = position_stack(vjust = 0.5)) + 
   scale_fill_manual(values = c("#D73027", "#FC8D59",
                               "#FEE090", "#E0F3F8", "91BfDB", "4575B4")) +
    labs(
      title = "Proportion of Preferred Game Mechanics",
      subtitle = "from surveyed students in DCS 210",
      x = "",
      y = "")
```
```{r game_mechanic_pie, alt.text = "Pie chart showing the distrobution of game mechanics perfered by DCS 210, broken down by proportion. The most prefered game mechnic was Area Control makig up 33.3 percent of responses. Dice rolling and card drafting were the next more popular, with 20 percent of the class perfering those mechanics."} 
prop_pie_cat <- data.frame (
  categories = c("Card", "War Game", "Fantasy", "Economic", "Fighting", "Science Fiction", "Dice"),
  cat_proportion = c(33.3, 33.3, 13.3, 6.6, 6.6, 6.6, 6.6))
  
ggplot(data = prop_pie_cat, mapping = aes(x = "", y = cat_proportion, fill = categories)) + 
    geom_bar(stat = "identity", color = "black") + 
    coord_polar(theta = "y", start = 0) + 
    geom_text(aes(label = paste0(cat_proportion, "%")),
              position = position_stack(vjust = 0.5)) + 
   scale_fill_manual(values = c("#D73027", "#FC8D59",
                               "#FEE090", "#FFFFBF", "#E0F3F8", "91BfDB", "4575B4")) +
    labs(
      title = "Proportion of Preferred Game Categories",
      subtitle = "from surveyed students in DCS 210",
      x = "",
      y = "")
```


```{r game_mechanic_pop_bar alt.text = ""}
board_games %>%
  separate_rows(mechanic, sep = ",") %>% 
  group_by(mechanic) %>% 
  subset(mechanic %in% c("Area Control / Area Influence", 
                         "Variable Player Powers", 
                         "Card Drafting", 
                         "Hex-and-Counter", 
                         "Modular Board", 
                         "Dice Rolling",
                         "Hand Management",
                         "Tile Placement",
                         "Set Collection")) %>% 
  mutate(count = n(), adjusted_rating = average_rating/count) %>% 
  mutate(median = median(adjusted_rating)) %>% 
  ggplot(aes(x = median, y = mechanic, color = mechanic, fill = mechanic)) +
  geom_col()
  #facet_grid(mechanic ~ average_rating)
```

```{r game_mechanic_pop_bar alt.text = ""}
board_games %>%
  separate_rows(mechanic, sep = ",") %>% 
  group_by(mechanic) %>% 
  subset(mechanic %in% c("Area Control / Area Influence")) %>% 
  mutate(median = median(average_rating)) %>% 
  mutate(count = n(), adjusted_rating = average_rating/count) %>% 
  ggplot(aes(y = adjusted_rating, x = mechanic, color = mechanic, fill = mechanic)) +
  geom_col() +
  facet_wrap( ~ playtime_group)
```